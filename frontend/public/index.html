<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Form with Vue.js</title>
    <!-- Include Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div id="app" class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    Login
                </div>
                <div class="card-body">

                    <!-- Sign Up Form -->
                    <form v-if="isSignUp" @submit.prevent="submitForm('users', 'Sign Up')">
                        <div class="form-group">
                            <label for="username">Email</label>
                            <input type="text" class="form-control" v-model="email" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" class="form-control" v-model="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Sign Up</button>
                    </form>

                    <!-- Sign In Form --
                    <form v-else @submit.prevent="submitForm('login', 'Sign In')">
                        <div class="form-group">
                            <label for="username">Email</label>
                            <input type="text" class="form-control" v-model="email" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" class="form-control" v-model="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Sign In</button>
                    </form>

                    <!-- Toggle Sign Up / Sign In Form --
                    <button class="btn btn-secondary mt-3" @click="toggleForm">{{ isSignUp ? 'Switch to Sign In' : 'Switch to Sign Up' }}</button>
                    -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Include Vue.js and Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>


    new Vue({
        el: '#app',
        data: {

            email: '',
            password: '',
            isSignUp: true,
        },
        methods: {

            async submitForm(endpoint, action) {
                try {
                    const response = await axios.post(`/${endpoint}`, {
                        email: this.email,
                        password: this.password,
                    });
                    //console.log(this.password)

                    if (this.password.length < 8) {
                        //return res.status(400).json({ error: 'Password must be at least 8 characters long' });
                        alert('Password must be at least 8 characters long');
                    }
                    else {
                        if (response.data) {
                            alert(`${action} successful: ${response.data.message}`);
                            if (endpoint === 'login') {
                                // Redirect to a dashboard or profile page after successful login
                                //this.$router.push('/dashboard'); // Change to your desired route
                                window.location.href = '/dashboard';
                            }
                        } else if (response.data.error) {
                            if (response.data.error.includes('already exists')) {
                                alert('User already exists. Please use a different email.');
                            } else {
                                alert(`${action} failed: ${response.data.error}`);
                            }
                        }
                    }

                } catch (error) {
                    //console.error('Error:', error);
                    //console.log(error.config.data.hasOwnProperty('password'));
                    if ( error.config.data !== "undefined" ) {

                        let jsonData = JSON.parse(error.config.data);

                        let price = jsonData["password"];

                        if (price.length < 8) {
                            //return res.status(400).json({ error: 'Password must be at least 8 characters long' });
                            alert('Password must be at least 8 characters long');
                        }
                    }
                    if (error.response && error.response.status === 400) {
                        alert('Error 400 - User already exists. Please use a different email.');
                    }
                    if (error.response && error.response.status === 409) {
                        alert('User already exists. Please use a different email.');
                    }
                    if  (error.response && error.response.status === 401) {
                        alert('Invalid credentials');
                    }
                    else {
                        //alert('An error Accured');
                        //console.log(error)
                    }
                }
            },
            toggleForm() {
                this.isSignUp = !this.isSignUp;
            },

        },
    });
</script>
</body>
</html>